<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>注册(qwy)</title>
	<link rel="shortcut icon" href="https://www.qwy.ac/icon.svg" type="image/svg">
	<link rel="icon" href="https://www.qwy.ac/icon.svg">
	<link rel="stylesheet" href="../index.css">
</head>
<script src="../index.js"></script>

<style>
	/* .text {
		border: 0.2vh solid black;
		margin-top: 1vh;
		margin-bottom: 1vh;
		font-size: 3vh;
	}

	.message {
		border: 0.2vh solid black;
		margin-top: 1vh;
		margin-bottom: 1vh;
		padding-top: 2vh;
		padding-left: 2vw;
		font-size: min(3vh, 3vw);
		height: 75vh;
		width: 98%;
		border-radius: 0.8vw;
		overflow-y: scroll;
	} */
</style>

<body>
	
	<br>
	<div class="page-container">
		<center>
			<input type="email" placeholder="用户名" id="username" style="height: 2vw; width: 20vw; border-radius: 0.2vw;">
			<button onclick="modal('3~15个字符, 不能数字开头, 只能包含数字和字母')"
				style="border-radius: 100px; border: 0px solid black; background-color: gainsboro;">?</button>
			<br>
			<br>
			<input type="password" placeholder="密码" id="password"
				style="height: 2vw; width: 20vw; border-radius: 0.2vw;">
			<button onclick="modal('6~20个字符')"
				style="border-radius: 100px; border: 0px solid black; background-color: gainsboro;">?</button>
			<br>
			<br>
			<input type="password" placeholder="确认密码" id="confirm"
				style="height: 2vw; width: 20vw; border-radius: 0.2vw;">
			<button onclick="modal('再输入一次密码')"
				style="border-radius: 100px; border: 0px solid black; background-color: gainsboro;">?</button>
			<br>
			<br>
			<input type="submit" value="确认" id="submit" style="height: 2vw; width: 5vw;">
		</center>
	</div>

	<script>
init();

		let url = 'https://ichat-api.qwy.ac/';
		// let url = 'http://192.168.218.75:3000/';
		document.getElementById('submit').onclick = async () => {

			if (document.getElementById('password').value != document.getElementById('confirm').value) {
				modal('密码不一致');
				return;
			}

			let response = await fetch(`${url}users`, {
				"method": "POST",
				"headers": {
					"content-type": "application/json"
				},
				"body": JSON.stringify({
					"uid": document.getElementById('username').value,
					"password": document.getElementById('password').value
				})
			});
			if (response.status >= 200 && response.status < 300) {
				let data = await response.text();
				let r = JSON.parse(data);
				localStorage.setItem('token', r.token);
				window.location = '../index.html';
			} else {
				document.getElementById('username').value = document.getElementById('password').value = document.getElementById('confirm').value = '';
				if (response.statusText == 'Conflict')
					modal('用户名存在');
				else
					modal('用户名或密码不合法');
			}

		}
	</script>

</body>
<script src="../nav.js"></script>

</html>