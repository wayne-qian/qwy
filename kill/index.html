<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>狼人杀</title>
	<link rel="shortcut icon" href="https://cdn.luogu.com.cn/upload/image_hosting/agn5wide.png" type="image/png">
	<link rel="icon" href="https://cdn.luogu.com.cn/upload/image_hosting/agn5wide.png">
</head>

<body>
	<marquee scrollamount="2" scrolldelay="1" style="height: 5vh;border: 0.1vh solid grey; font-size: 3vh;"> 欢迎来到
		Qianwenyu 的网站 </marquee>
	<center>
		<p id="p" style="margin-top: 30vh; font-size: 5vh;"></p>
		<input type="number" id="in" placeholder="请输入人数" style="width: 20vw; height: 3vh;">
		<button id="btn" style="width: 8vw; height: 8vh;">确认</button>
	</center>
	<script>
		let name = [[], [], [], [], ['狼人', '预言家', '平民', '平民'], ['狼人', '预言家', '平民', '平民', '平民']];
		let player = new Array(7);
		let f = new Array(7);
		let p = document.getElementById('p');
		let btn = document.getElementById('btn');
		let isvis = 0;
		let time = 0;
		let day = 0;
		let idplayer = 0;
		let num;
		let left;
		let alive = new Array(7);
		let ct = new Array(7);
		let kill;
		btn.onclick = function () {
			if (time == 0) {
				left = num = document.getElementById('in').value;
				if (num >= 4 && num <= 5)
					document.getElementById('in').remove(), getname(), time = 1, btn.innerText = '下一步', p.innerText = '请1号玩家获取身份';
			}
			else if (time == 1) {
				if (idplayer < num) {
					if (!isvis)
						p.innerText = `你是${++idplayer}号, 你的身份是${name[num][player[idplayer]]}.`, isvis = 1, btn.innerText = '确认';
					else {
						p.innerText = `请${idplayer + 1}号玩家获取身份`;
						isvis = 0, btn.innerText = '下一步';
					}
				}
				else
					time = 2, p.innerText = '', idplayer = 0, btn.innerText = '下一步';
			}
			else if (time == 2) {
				if (check() == 0) {
					if (day == 0) {
						btn.innerText = '下一步';
						if (idplayer == 0) {
							idplayer = 1;
							while (!alive[idplayer] && idplayer <= num)
								idplayer++;
							p.innerText = `请${idplayer}号玩家操作`;
						}
						else {
							if (player[idplayer] == 0) {
								let userin = 0;
								while (!alive[userin])
									userin = prompt(`你是${idplayer}号, 你的身份是${name[num][player[idplayer]]}, 请输入要杀的人.`);
								kill = userin;
							}
							else if (player[idplayer] == 1) {
								let userin = 0;
								while (!alive[userin])
									userin = prompt(`你是${idplayer}号, 你的身份是${name[num][player[idplayer]]}, 请输入要预言的人.`);
								alert(`${userin}号的身份是${name[num][player[userin]]}`);
							}
							else {
								alert(`你是${idplayer}号, 你的身份是${name[num][player[idplayer]]}.`);
							}
							idplayer++;
							while (!alive[idplayer] && idplayer <= num)
								idplayer++;
							if (idplayer > num) {
								p.innerText = '天亮了';
								day = 1;
								return;
							}
							p.innerText = `请${idplayer}号玩家操作`;
						}
					}
					else if (day == 1) {
						btn.innerText = '下一步';
						alive[kill] = 0;
						left--;
						p.innerText = `${kill}号死了, 点击下一步进入投票环节, 存活者 : `;
						for (let i = 0; i <= num; i++)
							ct[i] = 0;
						for (let i = 1; i <= num; i++)
							if (alive[i])
								p.innerText += `${i}号, `;
						p.innerText[p.innerText.length - 1] = '.';
						day = 2;
						idplayer = 1;
					}
					else if (day == 2) {
						while (!alive[idplayer] && idplayer <= num)
							idplayer++;
						let userin = 6;
						while ((!alive[userin] && userin > 0) || (userin == ''))
							userin = prompt(`请${idplayer}号玩家投票, 输入0表示弃票`);
						ct[userin]++;
						idplayer++;
						while (!alive[idplayer] && idplayer <= num)
							idplayer++;
						if (idplayer > num) {
							day = 3;
							return;
						}
					}
					else if (day == 3) {
						let mx = 0, mxid = 0, ctmx = 0;
						for (let i = 1; i <= num; i++)
							if (ct[i] > mx)
								mx = ct[i], mxid = i;
						for (let i = 1; i <= num; i++)
							if (mx == ct[i])
								ctmx++;
						idplayer = 0;
						if (ct[0] >= Math.ceil(num / 2)) {
							p.innerText = '弃票过半, 投票无效';
							day = 0;
							ct = new Array(7);
							return;
						}
						if (ctmx > 1) {
							p.innerText = '平票, 投票无效';
							day = 0;
							ct = new Array(7);
							return;
						}
						p.innerText = `${mxid}号玩家被放逐了, 身份是${name[num][player[mxid]]}`;
						alive[mxid] = 0;
						left--;
						day = 0;
						ct = new Array(7);
						return;
					}
				}
				else {
					time = 3;
					p.innerText = '游戏结束';
					btn.innerText = '下一步';
				}
			}
			else if (time == 3) {
				if (check() == 1)
					p.innerText = '狼人胜';
				else
					p.innerText = '平民胜';
			}
		}
		function check() {
			let cta = 0, ctb = 0;
			for (let i = 1; i <= num; i++)
				if (alive[i]) {
					if (player[i] == 0)
						cta++;
					else ctb++;
				}
			if (cta > 0 && ctb == 0)
				return 1;
			if (cta == 0 && ctb > 0)
				return 2;
			return 0;
		}
		function getname() {
			for (let i = 1; i <= num; i++) {
				alive[i] = 1;
				let ran = 6;
				while (ran == 6 || f[ran])
					ran = Math.floor(Math.random() * 10000) % num;
				f[ran] = 1;
				player[i] = ran;
			}
		}
	</script>
</body>

</html>